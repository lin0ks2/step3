(function(){'use strict';const App=window.App||(window.App={});App.Backup={export:ex,import:im,notify:n};function ex(){try{const d={version:App.APP_VER||'1.x',timestamp:new Date().toISOString(),settings:App.settings||{},state:App.state||{},dicts:localStorage.getItem('k_dicts_v1_3_1')||null};const b=new Blob([JSON.stringify(d,null,2)],{type:'application/json'});const u=URL.createObjectURL(b);const a=document.createElement('a');a.href=u;a.download='lexitron-backup-'+Date.now()+'.json';a.click();URL.revokeObjectURL(u);n('exportOk');}catch(e){(void 0);n('exportFail');}}function im(){const i=document.createElement('input');i.type='file';i.accept='application/json';i.addEventListener('change',function(ev){const f=ev.target.files&&ev.target.files[0];if(!f)return;const r=new FileReader();r.onload=function(e){try{const d=JSON.parse(e.target.result);if(!d||!d.settings||!d.state)throw new Error('Invalid');App.settings=d.settings;App.state=d.state;if(d.dicts)localStorage.setItem('k_dicts_v1_3_1',d.dicts);if(typeof App.saveSettings==='function')App.saveSettings();if(typeof App.saveState==='function')App.saveState();n('importOk');setTimeout(function(){location.reload();},500);}catch(err){(void 0);n('importFail');}};r.readAsText(f);});i.click();}function n(k){const T=(typeof App.i18n==='function')?(App.i18n()||{}):{};const M={exportOk:T.backupExportOk||'Файл резервной копии успешно сохранён.',exportFail:T.backupExportFail||'Ошибка при создании резервной копии.',importOk:T.backupImportOk||'Резервная копия восстановлена. Приложение перезапустится.',importFail:T.backupImportFail||'Ошибка восстановления. Проверьте файл.'};const msg=M[k]||'Info';if(typeof window.showConfirmModal==='function'){showConfirmModal({title:T.backupTitle||'Резервное копирование',message:msg,singleOk:true});}else{alert(msg);}}})();
