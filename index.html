<!DOCTYPE html>
<!--
  =====================================================================
  index.html ‚Äî Lexitron
  Version: 1.6.1
  Date: 2025-09-21

  Purpose:
    - Entry point for the Lexitron web app
    - Stable DOM ids expected by JS modules
    - Sections documented with clear comment dividers
  =====================================================================
-->

<html lang="uk">
<head>
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LEXITRON</title>

<link rel="apple-touch-icon" sizes="180x180" href="./apple-touch-icon-180x180.png?v=1.6.9">
  <link rel="apple-touch-icon" sizes="152x152" href="./apple-touch-icon-152x152.png?v=1.6.9">
  <link rel="apple-touch-icon" sizes="120x120" href="./apple-touch-icon-120x120.png?v=1.6.9">
  <link rel="apple-touch-icon" sizes="76x76" href="./apple-touch-icon-76x76.png?v=1.6.9">

                  <link rel="icon" type="image/png" sizes="192x192" href="./favicon-192x192.png?v=1.6.9">
<link rel="icon" type="image/png" sizes="512x512" href="./favicon-512x512.png?v=1.6.9">
<link rel="icon" type="image/png" sizes="256x256" href="./favicon-256x256.png?v=1.6.9">
<link rel="icon" type="image/png" sizes="192x192" href="./favicon-192x192.png?v=1.6.9">
<link rel="icon" type="image/png" sizes="128x128" href="./favicon-128x128.png?v=1.6.9">
<link rel="icon" type="image/png" sizes="48x48" href="./favicon-48x48.png?v=1.6.9">
<link rel="icon" type="image/png" sizes="16x16" href="./favicon-16x16.png?v=1.6.9">
<link rel="icon" type="image/png" sizes="512x512" href="./favicon-512x512.png?v=1.6.9">
<link rel="icon" type="image/png" sizes="128x128" href="./favicon-128x128.png?v=1.6.9">
<link rel="icon" type="image/png" sizes="32x32" href="./favicon-32x32.png?v=1.6.9">
<link rel="icon" type="image/png" sizes="32x32" href="./favicon-32x32.png?v=1.6.9">
<link rel="icon" href="./favicon.ico?v=1.6.9" type="image/x-icon">
<link rel="icon" sizes="512x512" href="./favicon-512x512.png?v=1.6.9">
<link rel="manifest" href="./site.webmanifest?v=1.6.9">

  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="LEXITRON">

<link rel="stylesheet" href="./style.css?v=1.6.9">

  <!-- ============================ SOCIAL PREVIEW ============================ -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="LEXITRON ¬∑ —É—á–∏—Ç–µ —Å–ª–æ–≤–∞ –ª–µ–≥–∫–æ">
  <meta property="og:description" content="–ö–∞—Ä—Ç–æ—á–∫–∏, –±—ã—Å—Ç—Ä—ã–µ —Å–µ—Å—Å–∏–∏, –ò–∑–±—Ä–∞–Ω–Ω–æ–µ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞. –£—á–∏—Ç–µ –Ω–æ–≤—ã–µ —Å–ª–æ–≤–∞ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –±–µ–∑ —Ä–µ–∫–ª–∞–º—ã –∏ –ø–æ–¥–ø–∏—Å–∫–∏.">
  <meta property="og:image" content="./og-image.png?v=1.6.9">
  <meta property="og:image:type" content="image/png">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="LEXITRON ¬∑ —É—á–∏—Ç–µ —Å–ª–æ–≤–∞ –ª–µ–≥–∫–æ">
  <meta name="twitter:description" content="–ö–∞—Ä—Ç–æ—á–∫–∏, –±—ã—Å—Ç—Ä—ã–µ —Å–µ—Å—Å–∏–∏, –ò–∑–±—Ä–∞–Ω–Ω–æ–µ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞. –£—á–∏—Ç–µ –Ω–æ–≤—ã–µ —Å–ª–æ–≤–∞ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –±–µ–∑ —Ä–µ–∫–ª–∞–º—ã –∏ –ø–æ–¥–ø–∏—Å–∫–∏.">
  <meta name="twitter:image" content="./og-image.png?v=1.6.9">

<style id="modal-inline-fix-1.6.3-1758932002">
/* Critical inline for iOS cache issues ‚Äî v1.6.5-1758932002 */
.modal .modalHeader{display:flex!important;align-items:center!important;justify-content:space-between!important;padding:14px 14px!important;border-bottom:1px solid rgba(255,255,255,.08)!important}
.modal .modalHeader .modalTitle{margin:0!important;font-size:20px!important;font-weight:700!important;line-height:1.2!important}
.modal .iconBtn.small{width:32px!important;height:32px!important;display:inline-flex!important;align-items:center!important;justify-content:center!important;font-size:18px!important;border-radius:8px!important;background:transparent!important;border:1px solid rgba(255,255,255,.08)!important;opacity:.9!important}
#modal .modalBody{padding-bottom:0px!important}
#modal .dictList{padding-bottom:14px!important}
#modal .dictList > *:last-child{margin-bottom:8px!important}
</style>

</head>
<body>

<header>
    <div class="brand">
      <img class="logo-mark"
           src="./favicon-32x32.png?v=1.6.9"
           srcset="./logo_64.png?v=1.6.9 2x, ./favicon-128x128.png?v=1.6.9 4x, ./logo_256.png?v=1.6.9 8x"
           alt="LEXITRON" width="28" height="28"
           decoding="async" loading="eager"/>
      <div class="title-wrap">
        <h1 id="title">Lexitron <span class="ver" id="appVer"></span></h1>
        <div class="tagline" id="tagline">–û–Ω –Ω–∞—É—á–∏—Ç!</div>
      </div>
    </div>
<div class="sectionDivider settingsDividerBelowToggle"></div>
    <div class="controls">
      <button id="themeToggleBtn" class="iconBtn" data-title-key="tt_ui_theme" aria-label="–¢–µ–º–∞">üåû</button>
      <button id="langToggleBtn"  class="iconBtn" data-title-key="tt_ui_lang" aria-label="–Ø–∑—ã–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞">üá∫üá¶</button>
      <button id="dictsBtn"       class="iconBtn gear" data-title-key="tt_dicts" aria-label="–°–ª–æ–≤–∞—Ä–∏">üìö</button>
    </div>
  </header>

<details class="dictSpoiler" id="dictSpoiler">
  <summary><span class="flag" id="dictFlag">üìö</span><span class="name" id="dictTitleInSpoiler">‚Äî</span></summary>
  <div id="setControls">
    <div id="setsBar" class="setsBar" aria-label="Sets"></div>
    <div id="setStats" class="setStats statsBar" aria-live="polite"></div>
  </div>
</details>

<main>
    <section class="card">
      <div class="topRow">
        <div class="stars" id="stars"></div>
        <button id="favBtn" class="heart" data-title-key="tt_favorites" aria-label="–î–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ">‚ô°</button>
      </div>

      <div class="word" id="wordText">‚Äî</div>
      <div class="hint" id="hintText">‚Äî</div>

      <div class="options" id="optionsRow"></div>

      <div class="statsBar" id="statsBar">
        –í—Å–µ–≥–æ —Å–ª–æ–≤: 0 / –ò–∑—É—á–µ–Ω–Ω–æ: 0 / –û—à–∏–±–æ–∫: 0
      </div>
    </section>

    <div class="extraActions" aria-label="Extra actions">
      <button id="btnInfo" class="iconBtn" data-title-key="tt_help" aria-label="–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è">‚ÑπÔ∏è</button>
      <button id="btnDonate" class="iconBtn" data-title-key="tt_support" aria-label="–ü–æ–¥–¥–µ—Ä–∂–∫–∞">üí∞</button>

      <button id="btnSettings" class="iconBtn" data-title-key="tt_settings" aria-label="–ù–∞—Å—Ç—Ä–æ–π–∫–∏">‚öôÔ∏è</button>
    </div>

    <!-- Info modal with footer OK in same style as Dicts modal -->
    <!-- Settings modal (same structure as Info) -->
    <div id="settingsModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="settingsTitle">
      <div class="modalFrame">
        <div class="modalHeader">
          <div class="modalTitle" id="settingsTitle" data-i18n="settingsTitle">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</div>
          <button class="iconBtn small" id="settingsClose" aria-label="Close">‚úñÔ∏è</button>
        </div>
        <div class="modalBody">
          <div id="settingsContent" class="infoContent">
<!-- Mode toggle -->
  <h3 class="backupTitle" data-i18n="modeSelection" style="text-align:left">–í—ã–±–æ—Ä —Ä–µ–∂–∏–º–∞</h3>

<div id="modeToggleWrap">
  <label class="switchLabel">
    <span data-i18n="modeNormal">–û–±—ã—á–Ω—ã–π —Ä–µ–∂–∏–º</span>
    <label class="switch">
      <input type="checkbox" id="modeToggle">
      <span class="slider"></span>
    </label>
    <span data-i18n="modeHard">–°–ª–æ–∂–Ω—ã–π —Ä–µ–∂–∏–º</span>
  </label>
</div>
<div class="sectionDivider"></div>
<div id="backupSection">
<h3 class="settingsSubtitle" data-i18n="backupTitle" style="text-align:left">–†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ</h3>
<div class="btnRow">
  <button class="btn" id="btnBackupExport" data-i18n="backupExport">–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
  <button class="btn" id="btnBackupImport" data-i18n="backupImport">–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
</div>
</div>
<script>
document.addEventListener('DOMContentLoaded', function(){
  try {
    var e = document.getElementById('btnBackupExport');
    var i = document.getElementById('btnBackupImport');
    if (e && window.App && App.Backup) e.addEventListener('click', function(){ App.Backup.export(); });
    if (i && window.App && App.Backup) i.addEventListener('click', function(){ App.Backup.import(); });
  } catch(_) {}
});
</script>

</div>
        </div>
        <div class="modalActions center">
          <button id="settingsOk" class="btn primary" data-i18n="ok">OK</button>
        </div>
      </div>
    </div>

    <!-- Donate modal (same structure as Settings) -->
    <div id="donateModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="donateTitle">
      <div class="modalFrame">
        <div class="modalHeader">
          <div class="modalTitle" id="donateTitle" data-i18n="donateTitle">–ü–æ–¥–¥–µ—Ä–∂–∞—Ç—å –ø—Ä–æ–µ–∫—Ç</div>
          <button class="iconBtn small" id="donateClose" aria-label="Close">‚úñÔ∏è</button>
        </div>
        <div class="modalBody">
          <div id="donateContent" class="infoContent center">
  <div id="donate-button-container" class="mt-20">
    <div id="donate-button"></div>
    <script src="https://www.paypalobjects.com/donate/sdk/donate-sdk.js" charset="UTF-8"></script>
    <script>
      PayPal.Donation.Button({
        env:'production',
        hosted_button_id:'KFBR8BW5ZZTQ4',
        image: {
          src:'https://www.paypalobjects.com/en_US/i/btn/btn_donateCC_LG.gif',
          alt:'Donate with PayPal button',
          title:'PayPal - The safer, easier way to pay online!'
        }
      }).render('#donate-button');
    </script>
  </div>
</div>
        </div>
        <div class="modalActions center">
          <button id="donateOk" class="btn primary" data-i18n="ok">OK</button>
        </div>
      </div>
    </div>

    <div id="infoModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="infoTitle">
      <div class="modalFrame">
        <div class="modalHeader">
          <div class="modalTitle" id="infoTitle">Info</div>
          <button class="iconBtn small" id="infoClose" aria-label="Close">‚úñÔ∏è</button>
        </div>
        <div class="modalBody">
          <div id="infoContent" class="infoContent"></div>
        </div>
        <div class="modalActions center">
          <button id="infoOk" class="primary">OK</button>
        </div>
      </div>
    </div>

</main>

  <!-- Dicts modal -->
  <div id="modal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
  <div class="backdrop" id="backdrop"></div>
  <div class="dialog">
    <!-- –®–∞–ø–∫–∞ -->
    <div class="modalHeader">
      <h2 class="modalTitle" id="modalTitle">–°–ª–æ–≤–∞—Ä–∏</h2>
      <button id="modalClose" class="iconBtn small" aria-label="Close">‚úñÔ∏è</button>
    </div>

    <!-- –¢–µ–ª–æ -->
    <div class="modalBody">
      <div id="langFlags" class="flagsRow flex-center gap-10 m-10"></div>
      <div class="field">
        <div class="dictList" id="dictList"></div>
      </div>
    </div>

    <!-- –§—É—Ç–µ—Ä -->
    <div class="modalActions center">
      <button id="okBtn" class="primary">OK</button>
    </div>
  </div>
</div>

<script src="i18n.js?v=1.6.9"></script>
  <script src="dicts.js?v=1.6.9"></script>

  <script src="deck.de.js?v=1.6.9"></script>
  <script src="deck.sr.js?v=1.6.9"></script>
  <script src="deck.en.js?v=1.6.9"></script>
  <script src="deck.fr.js?v=1.6.9"></script>

<script src="app.core.js?v=1.6.9"></script>
<script src="app.decks.js?v=1.6.9"></script>
<script src="theme.js?v=1.6.9"></script>
<script src="app.trainer.js?v=1.6.9"></script>
<script src="app.mistakes.js?v=1.6.9"></script>
<script src="app.favorites.js?v=1.6.9"></script>
<script src="app.ui.view.js?v=1.6.9"></script>
<script src="ui.options.safe.js?v=1.6.9"></script>
<script src="ui.setup.modal.js?v=1.6.9"></script>

<script src="ui.bus.js?v=1.6.9"></script>
<script src="ui.state.js?v=1.6.9"></script>
<script src="ui.sets.js?v=1.6.9"></script>
<script src="ui.progress.scope.js?v=1.6.9"></script>
<script src="ui.stats.core.js?v=1.6.9"></script>
<script src="app.backup.js?v=1.6.9"></script>
<script src="ui.lifecycle.js?v=1.6.9"></script>
<script src="ui.sets.done.js?v=1.6.9"></script>
<script src="ui.fix.js?v=1.6.9"></script>

  <!-- --------------------------  –ö –û –ù –ï –¶  --------------------------- -->
<script>
(function(){
  function hydrateI18N(){
    try{
      var App = window.App || {};
      var bag = (App.i18n && App.i18n()) || (window.I18N && (window.I18N[(App.settings&&App.settings.lang)||'uk'] || window.I18N.uk)) || {};
      document.querySelectorAll('[data-i18n]').forEach(function(el){
        var key = el.getAttribute('data-i18n');
        if (bag && bag[key]) el.textContent = bag[key];
      });
      document.querySelectorAll('[data-i18n-title]').forEach(function(el){
        var key = el.getAttribute('data-i18n-title');
        if (bag && bag[key]) el.setAttribute('title', bag[key]);
      });
      document.querySelectorAll('[data-i18n-aria]').forEach(function(el){
        var key = el.getAttribute('data-i18n-aria');
        if (bag && bag[key]) el.setAttribute('aria-label', bag[key]);
      });
    }catch(e){/*noop*/}
  }
  window.hydrateI18N = hydrateI18N;
  document.addEventListener('DOMContentLoaded', hydrateI18N);
  document.addEventListener('i18n:lang-changed', hydrateI18N);
})();
</script>

  <!-- Unified Confirm Modal -->
  <div id="confirmModal" class="modal confirmModal hidden" role="dialog" aria-modal="true" aria-labelledby="confirmTitle" aria-describedby="confirmText">
    <div class="modalFrame">
      <div class="modalHeader">
        <div class="modalTitle" id="confirmTitle">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ</div>
        <button class="iconBtn small" id="confirmClose" aria-label="Close">‚úñÔ∏è</button>
      </div>
      <div class="modalBody">
        <div id="confirmText" class="infoContent">–í—ã —É–≤–µ—Ä–µ–Ω—ã?</div>
      </div>
      <div class="modalActions center">
        <button id="confirmOk" class="btn primary">OK</button>
        <button id="confirmCancel" class="btn">–û—Ç–º–µ–Ω–∞</button>
      </div>
    </div>
  </div>

  <script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', function() {
      navigator.serviceWorker.register('./sw.js').catch(function(e){ console.warn('SW registration failed', e); });
    });
  }
  </script>

  <script src="app.spoiler.bootstrap.js?v=1.6.9"></script>

<script>
(function(){
  function detectLang(){
    try{
      var u = localStorage.getItem('lang') || localStorage.getItem('language') || localStorage.getItem('appLang');
      if(!u){
        if (navigator.languages && navigator.languages.length) u = navigator.languages[0];
        else u = navigator.language || (document.documentElement.getAttribute('lang')||'');
      }
      u = (u||'en').toLowerCase();
      if(u.startsWith('ru')) return 'ru';
      if(u.startsWith('uk') || u.startsWith('ua')) return 'uk';
      return 'en';
    }catch(e){ return 'en'; }
  }

  var lang = detectLang();
  var hrefMap = {
    privacy: './privacy.'+lang+'.html',
    terms: './terms.'+lang+'.html',
    impressum: './impressum.'+lang+'.html'
  };
  var labelMap = {
    en: { privacy:'Privacy Policy', terms:'Terms of Use', impressum:'Legal Notice' },
    ru: { privacy:'–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏', terms:'–£—Å–ª–æ–≤–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è', impressum:'–Æ—Ä–∏–¥–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è' },
    uk: { privacy:'–ü–æ–ª—ñ—Ç–∏–∫–∞ –∫–æ–Ω—Ñ—ñ–¥–µ–Ω—Ü—ñ–π–Ω–æ—Å—Ç—ñ', terms:'–£–º–æ–≤–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è', impressum:'–Æ—Ä–∏–¥–∏—á–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è' }
  };
  document.querySelectorAll('.footer-links a[data-legal]').forEach(function(a){
    var key = a.getAttribute('data-legal');
    if(hrefMap[key]) a.setAttribute('href', hrefMap[key]);
    if(labelMap[lang] && labelMap[lang][key]) a.textContent = labelMap[lang][key];
  });
})();
</script>
<div id="footer-placeholder"></div>
</div>
<script>
(function(){
  function normalizeLang(v){
    v = String(v||'').toLowerCase();
    if (v.startsWith('ru')) return 'ru';
    if (v.startsWith('uk') || v.startsWith('ua')) return 'uk';
    return 'en';
  }
  function uiLang(){
    try{
      var lang = (window.App && App.settings && App.settings.lang) || localStorage.getItem('lexitron.uiLang') || navigator.language || 'en';
      return normalizeLang(lang);
    }catch(e){ return 'en'; }
  }
  var LABELS = {
    en:{privacy:'Privacy Policy',terms:'Terms of Use',impressum:'Legal Notice'},
    ru:{privacy:'–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏',terms:'–£—Å–ª–æ–≤–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è',impressum:'–Æ—Ä–∏–¥–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è'},
    uk:{privacy:'–ü–æ–ª—ñ—Ç–∏–∫–∞ –∫–æ–Ω—Ñ—ñ–¥–µ–Ω—Ü—ñ–π–Ω–æ—Å—Ç—ñ',terms:'–£–º–æ–≤–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è',impressum:'–Æ—Ä–∏–¥–∏—á–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è'}
  };
  function applyFooterI18n(root){
    var lang = uiLang();
    (root || document).querySelectorAll('.site-footer [data-legal]').forEach(function(a){
      var k = a.getAttribute('data-legal');
      a.href = './'+k+'.'+lang+'.html';
      a.textContent = (LABELS[lang] && LABELS[lang][k]) || (LABELS.en[k] || k);
      a.setAttribute('hreflang', lang);
    });
  }
  function injectFooter(){
    fetch('./footer_snippet.html', {cache: 'no-store'})
      .then(function(r){ return r.text(); })
      .then(function(html){
        var ph = document.getElementById('footer-placeholder');
        if (!ph) {
          ph = document.createElement('div');
          ph.id = 'footer-placeholder';
          document.body.appendChild(ph);
        }
        ph.innerHTML = html;
        applyFooterI18n(ph);
      })
      .catch(function(e){ console.error('Footer load failed:', e); });
  }
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', injectFooter);
  } else {
    injectFooter();
  }
  window.addEventListener('lexi:lang-changed', function(){ applyFooterI18n(); });
})();
</script>

<script>
// Live i18n runtime: call setUiLang('en'|'ru'|'uk') to switch instantly
(function(){
  function normalizeLang(v){
    v = String(v||'').toLowerCase();
    if (v.startsWith('ru')) return 'ru';
    if (v.startsWith('uk') || v.startsWith('ua')) return 'uk';
    return 'en';
  }

  // storage sync across tabs
  window.addEventListener('storage', function(ev){
    if (ev.key === 'lexitron.uiLang' && ev.newValue){
      try {
        var lang = normalizeLang(ev.newValue);
        if (window.App && App.settings) {
          try {
            App.settings.lang = lang; // if patched setter exists it will dispatch
          } catch (_) {}
        }
        window.dispatchEvent(new CustomEvent('lexi:lang-changed', {detail:{lang: lang}}));
      } catch(e){ console.error(e); }
    }
  });

  // Expose simple API
  window.setUiLang = function(lang){
    try {
      lang = normalizeLang(lang);
      // persist
      try { localStorage.setItem('lexitron.uiLang', lang); } catch(_){}
      // update App.settings.lang if available
      if (window.App && App.settings) {
        try { App.settings.lang = lang; } catch(_){}
      }
      // notify listeners (footer, headers, etc.)
      window.dispatchEvent(new CustomEvent('lexi:lang-changed', {detail:{lang: lang}}));
    } catch(e){ console.error(e); }
  };

  // Optional: patch App.settings.lang to auto-dispatch when changed by other code
  try {
    if (window.App && App.settings && !Object.getOwnPropertyDescriptor(App.settings,'lang').set) {
      var _lang = (App.settings.lang || localStorage.getItem('lexitron.uiLang') || navigator.language || 'en');
      _lang = normalizeLang(_lang);
      Object.defineProperty(App.settings, 'lang', {
        get: function(){ return _lang; },
        set: function(v){
          _lang = normalizeLang(v);
          try { localStorage.setItem('lexitron.uiLang', _lang); } catch(_){}
          window.dispatchEvent(new CustomEvent('lexi:lang-changed', {detail:{lang: _lang}}));
        }
      });
    }
  } catch(e){ /* ignore */ }
})();
</script>
</body>
</html>
